<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Detailed Report Page</title>
    <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <link rel="stylesheet" href="./style.css">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

  </head>
  <body>
    <main>
      <nav class="navbar bg-light">
        <div class="container-fluid">

          <a class="navbar-brand" href="https://www.brightsolid-manager.co.uk/dashboardAuditor.html">Home</a>
          <a class="navbar-brand" href="#">Navbar</a>

        </div>
      </nav>
        <div class="container" id ="container">
          <div class ="status">
            <div class="row">

                <div class="col-7">
                  <h2 id="rule"></h2>
                </div>
              <div class="col-5">
                <h2 id="complianceStatus">Status: Compliant</h2>
              </div>
            </div>
            <div class="row">
                <div class="col-9">
                </div>
                <div class="col-1">
                    <span id="complianceDot"></span>
                </div>
            </div>
            <div id="chart">
            
                  <h3>Rule Compliancy</h3>
                  <canvas id="resourceChart" style="max-width: 800px; max-height: 800px; margin:auto;"></canvas>
       

                <div class="col-6">
                  <h2>Rule</h2>
                </div>
              <div class="col-4">
                <h2>Status: Compliant</h2>
              </div>
              <div class="col-1">
                <span class ="dot"></span>
              </div>
            </div>
          </div>
          <h3>Change Font Size</h3>
          <button type="button" 
          onclick="changeSizeByBtn('medium')" name="btn1">
              -
          </button>
        
         <button type="button" 
          onclick="changeSizeByBtn('xx-large')" name="btn2">
              +
        </button>
        <div class="rule-info" id="rule-info">
            <h4>Rule Description</h4>
            <p id="description"> </p>
        </div>
 
        <table class="table" id="resourceData">
            <h4>Resources</h4>
            <thead>
            <tr>
                <th>Resource ID</th>
                <th>Resource Name</th>
                <th>Resource Reference</th>
                <th>Compliant?</th>
          </thead>
          </tr>
          <tr>

          </tr>
            
    </table>
      </div>
    </main>
    <script src="jscript.js"></script>
    <script>
        

        var pageNumber = sessionStorage.getItem("pageNumber");
        console.log(pageNumber);
        
        $.getJSON('https://i84e30oa3l.execute-api.eu-west-2.amazonaws.com/rds-api-post/rds-api', function(data) {
                const jString = JSON.stringify(data.body);   
                jsonRuleData = JSON.parse(jString);  
                var counter = jsonRuleData[pageNumber];
                parsed = JSON.parse(counter);
                document.getElementById("rule").innerHTML = parsed.rule_name;
                document.getElementById("description").innerHTML = parsed.rule_description;

                var nonCompliant = parsed.non_compliant_resources
                var status = "Compliant"
                if (nonCompliant > 0) {
                    status = "Non-Compliant"
                    document.getElementById("complianceDot").innerHTML = "<span class = 'redDot'>"
                }
                else{
                    document.getElementById("complianceDot").innerHTML = "<span class = 'greenDot'>"
                }
                document.getElementById("complianceStatus").innerHTML = "Status: " + status;
                $.getJSON('https://xspjl4bgeb.execute-api.eu-west-2.amazonaws.com/rds-resource-stage/rds-api', function(data) {
                const jString = JSON.stringify(data.body);   
                jsonRuleData = JSON.parse(jString);
                
                var total = 0
                var nonCompliant = 0
                console.log("working")
                for (var i = 1; i < jsonRuleData.length - 1; i++) {
                    
                    var counter = jsonRuleData[i];
                    resourceParsed = JSON.parse(counter);
                    
                    function displayInfo(compliance, dot){
                    var tblRow =  "<tr>" + "<td>" + resourceParsed.resource_id + "</td>" +
                    "<td>" + resourceParsed.resource_name + "</td>" + "<td>" + resourceParsed.resource_ref + "</td>" + "<td>" + compliance + dot + "</td>" + "<td>"
                    $(tblRow).appendTo("#resourceData tbody");
                    }
                    if (resourceParsed.resource_type_id == parsed.resource_type_id){
                        if (resourceParsed.compliant == 'None'){
                            displayInfo("Yes  ", "<span class = 'greenDot' style = 'height: 20px; width: 20px'>");
                        }
                        else{
                            displayInfo("No  ", "<span class = 'redDot' style = 'height: 20px; width: 20px'>");
                                nonCompliant += 1
                        }
                        total += 1
                    }
                    
                    }
                    console.log("working")
                    var compliance = []
                    
                    var compliant = total - nonCompliant
                    compliance[0] = compliant
                    compliance[1] = nonCompliant
                    makeChart(compliance, 'resourceChart')
                });

        });
        
        function makeChart(compliance, chartName){
                const data = {
                labels: [
                  'Non-Compliant',
                  'Compliant'
                  ],
                  datasets: [{
                    label: 'My First Dataset',
                    color: '#ffffff',
                    data: [compliance[1], compliance[0]],
                    backgroundColor: [
                      'rgb(248, 60, 2)',
                      'rgb(23, 235, 52)',
                    ],
                    hoverOffset: 4
                    }]
                  };
                  const config = {
                  type: 'doughnut',
                  data: data,
                  };
              
              const myChart = new Chart(
                document.getElementById(chartName),
                config
                )
                };
        
    </script>
            <p> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras fringilla mauris finibus nulla consectetur, a facilisis ligula rhoncus. Praesent efficitur in dui id
                pretium. Quisque tincidunt viverra fringilla. Nam a arcu sed tellus interdum porta et quis enim. Maecenas rhoncus odio vel mattis facilisis. Vivamus ullamcorper 
                sollicitudin nibh, non posuere turpis scelerisque sit amet. In hac habitasse platea dictumst. Proin euismod vel nibh non posuere. Aenean ultricies tempus scelerisque.
                Curabitur malesuada mattis odio, eu sodales ex. Vestibulum cursus venenatis maximus. Morbi nec molestie magna. Mauris sit amet malesuada quam. Nullam ullamcorper, 
                dui a mollis accumsan, est sapien dapibus tortor, ac facilisis lectus mauris ac ligula. Praesent blandit velit ac mi hendrerit, a egestas enim malesuada.
                </p>
                <p>
                Nunc condimentum vulputate mauris, ac elementum augue eleifend sit amet. Suspendisse imperdiet cursus maximus. Sed lacinia lobortis libero nec vestibulum. 
                Suspendisse luctus lorem a tortor aliquet, non volutpat ex efficitur. Vivamus a leo nulla. Proin consectetur odio vitae est pharetra finibus. Nulla non dolor
                non leo interdum egestas. Cras tristique massa et purus accumsan luctus. Donec sodales tellus nunc, a finibus quam sagittis vel. Vivamus eget nulla et sapien
                empus finibus ut id nisi. Maecenas lorem urna, mattis ac vestibulum eget, euismod in dui. Etiam ut dui vel mi feugiat iaculis vitae quis dolor. Sed eget
                elementum massa.
                </p>
                <p>
                Duis efficitur neque nec dictum laoreet. Fusce semper velit at nibh rhoncus, eu eleifend nulla tincidunt. Pellentesque mi sem, vulputate sit amet arcu vulputate, volutpat pulvinar nisl. Mauris rutrum gravida convallis. Phasellus ut nisl vitae tellus congue consequat vitae ac nulla. Praesent ut ligula sodales, euismod turpis sed, dignissim massa. Nam libero sapien, placerat quis scelerisque non, eleifend sed tortor.
                
                Sed commodo et ipsum sit amet placerat. Integer eleifend sodales dolor, eget sodales turpis semper eu. Integer volutpat pellentesque sem accumsan suscipit. Suspendisse aliquet vehicula massa, sed vehicula ipsum imperdiet sit amet. Ut consequat dolor a imperdiet fringilla. Aenean sed gravida mauris, in sagittis erat. Integer ante est, hendrerit sed posuere quis, imperdiet id leo. Sed venenatis eget enim a varius. Suspendisse dapibus tincidunt porta. Nullam eget mi imperdiet erat lacinia pharetra et a turpis. Suspendisse sed sem nisl. Nulla vitae quam volutpat enim aliquet viverra. In diam ligula, tincidunt quis scelerisque sed, condimentum vitae nisl. In eu purus vulputate nunc facilisis tincidunt ac sed turpis.</p>
        </div>
        <div class="current-exception" id="smallText">
            <div class="row">
                <div class="col">
                    <h3>Current Exception</h3>
                    <div id="exception-info">
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras fringilla mauris finibus nulla consectetur, a facilisis ligula rhoncus. Praesent efficitur in dui id
                        pretium. Quisque tincidunt viverra fringilla</p>
                    </div>
                </div>
                <div class="col">
                    <h3>Review Date</h3>
                    <div id="exception-date">
                      <p>25/12/2024</p>
                    </div>
                </div>
            </div>        
          </div>
        
      </div>
    </main>
    <script src="jscript.js"></script>
  </body>
</html>
