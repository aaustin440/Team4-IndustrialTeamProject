<!DOCTYPE html>
<html>
<head>
  <title>Compliance_Summary_Dashboard</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="stylesheet" href="./style.css">
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <!-- need to agree on font, colours, bootstrap version -->
</head>
<body>
    <main>
    <nav class="navbar bg-light">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">Navbar</a>
        </div>
      </nav>

    <div class="container" id ="container">
        <h2>Summary Dashboard</h2>
        <div class ="row" id ="sortChange">
            
            <div class="col-8" id ="fontSize">
            <h3>Change Font Size</h3>
                <button type="button" 
                    onclick="changeSizeByBtn('medium')" name="btn1">
                        -
                </button>
                    
                <button type="button" 
                    onclick="changeSizeByBtn('xx-large')" name="btn2">
                        +
                </button>
            </div>
            <div class ="col-4">
                <div class="dropdown">
                    <button class="bstn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                    Sort By
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                    <li><a class="dropdown-item" href="#"> Review Date</a></li>
                    <li><a class="dropdown-item" href="#">Exception</a></li>
                    <li><a class="dropdown-item" href="#">Something else here</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div id ="chart">
          <canvas id="myChart"></canvas>
        </div>
        <p id="demo"></p>
        
          
        <table class="table" id="ruleData">
                <thead>
                <tr>
                    <th>Rule</th>
                    <th>Description</th>
                    <th>Number of Resources</th>
                    <th>Compliant Resources</th>
                    <th>Non-Compliant Resources</th>
                    <th>Number of Exceptions</th>
                    <th>Status</th>
                    
              </thead>
              </tr>
              <tr>
                <button id="LearnMore">Learn More</button>
              </tr>
                
        </table>
        </div>
    </main>
    <script src="jscript.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">

</script>
<script>
    $(function() {
      var compliant
      var nonCompliant
      var body = [];
      $.getJSON('https://i84e30oa3l.execute-api.eu-west-2.amazonaws.com/rds-api-post/rds-api', function(data) {
          const jString = JSON.stringify(data.body);   
          jsonRuleData = JSON.parse(jString);   
          
          

          for (var i = 1; i < jsonRuleData.length; i++) {
                var counter = jsonRuleData[i];
                parsed = JSON.parse(counter);

                nonCompliant = parsed.non_compliant_resources
                compliant = parsed.total_count - nonCompliant
                var status = "Compliant"
                if (nonCompliant > 0) {
                  status = "Non-Compliant"
                }

                let button = document.createElement('button');
                button.innerText = "Learn More";
                button.id = i;
                

                var name = parsed.rule_name
                function displayInfo(compliance){
                  var tblRow =  "<tr>" + "<td>" + parsed.rule_name + "</td>" +
                  "<td>" + parsed.rule_description + "</td>" + "<td>" + parsed.total_count + "</td>" + "<td>" + compliant + "</td>" + "<td>"
                  + parsed.non_compliant_resources + "</td>" + "<td>"
                  + parsed.exception_count + "</td>" + "<td>" + status + compliance + "</span>" + "</td>" + "<td>" + button.outerHTML + "</td>" + "</tr>" 
                  $(tblRow).appendTo("#ruleData tbody");
                }
                if (nonCompliant > 0) {
                  displayInfo("<span class = 'redDot'>")
                }
                else{
                  displayInfo("<span class = 'greenDot'>")
                }
                


                $("button").click(function() {
                  location.href = "https://www.brightsolid-manager.co.uk/DetailedReportPage.html"
                  //location.href = "DetailedReportManager.html"
                  var pageNumber = this.id;
                  sessionStorage.setItem("pageNumber", pageNumber);
                }); 
              }
              });
              });
              </script>
              <script>
                var compliance = []
                var nonCompliant = 0
                var total = 0
                $(function() {
                src="https://cdn.jsdelivr.net/npm/chart.js"
                $.getJSON('https://i84e30oa3l.execute-api.eu-west-2.amazonaws.com/rds-api-post/rds-api', function(data2) {
                const jString = JSON.stringify(data2.body);
  
                jsonRuleData = JSON.parse(jString);   
                
                
                for (var i = 1; i < jsonRuleData.length - 1; i++) {
                      var counter = jsonRuleData[i];
                      parsed = JSON.parse(counter);
                      nonCompliant += parsed.non_compliant_resources;
                      total += parsed.total_count
                      
                }
                compliance[0] = total
                compliance[1] = nonCompliant
                makeChart(compliance)
                });
              });

              function makeChart(compliance){
                console.log(compliance[0]);
                const data = {
                labels: [
                  'Non-Compliant',
                  'Compliant'
                  ],
                  datasets: [{
                    label: 'My First Dataset',
                    color: '#ffffff',
                    data: [compliance[1], compliance[0]],
                    backgroundColor: [
                      'rgb(248, 60, 2)',
                      'rgb(23, 235, 52)',
                    ],
                    hoverOffset: 4
                    }]
                  };
                  const config = {
                  type: 'doughnut',
                  data: data,
                  };
              
              const myChart = new Chart(
                document.getElementById('myChart'),
                config
                )
                };
        </script>
    
    </body>
</html>
